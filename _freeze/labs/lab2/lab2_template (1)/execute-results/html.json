{
  "hash": "004edf849ee2d3993187cc4fef62195a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lab 2: Spatial Analysis and Visualization\"\nsubtitle: \"Healthcare Access and Equity in Pennsylvania\"\nauthor: \"Shubhanga Satyal\"\ndate: today\nformat: \n  html:\n    code-fold: false\n    toc: true\n    toc-location: left\n    theme: cosmo\n    embed-resources: true\nexecute:\n  warning: false\n  message: false\n---\n\n## Assignment Overview\n\n**Learning Objectives:**\n- Apply spatial operations to answer policy-relevant research questions\n- Integrate census demographic data with spatial analysis\n- Create publication-quality visualizations and maps\n- Work with spatial data from multiple sources\n- Communicate findings effectively for policy audiences\n\n---\n\n## Part 1: Healthcare Access for Vulnerable Populations\n\n\n### Research Question\n\n**Which Pennsylvania counties have the highest proportion of vulnerable populations (elderly + low-income) living far from hospitals?**\n\n\n### Analysis Steps\n\n#### Step 1: Data Collection \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages - loaded all packages I could \nlibrary(tidyverse)\nlibrary(tidycensus)\nlibrary(scales)\nlibrary(RColorBrewer)\nlibrary(sf)\nlibrary(tidyverse)\nlibrary(tigris)\nlibrary(tidycensus)\nlibrary(scales)\nlibrary(patchwork)\nlibrary(knitr)\n\n\n# Load spatial data\npa_counties <- st_read(\"data/Pennsylvania_County_Boundaries.shp\")\nhospitals <- st_read(\"data/hospitals.geojson\")\ncensus_tracts <- tracts(state = \"PA\", cb = TRUE)\n\n\n#Transformed to Same County\nhospitals <- st_transform(hospitals, st_crs(pa_counties))\ncensus_tracts <- st_transform(census_tracts, st_crs(pa_counties))\n\n\n# Checking that all data loaded correctly\nhead(pa_counties)\nhead(hospitals)\nhead(census_tracts)\nhead(census_tracts)\n\n\n#summarizing to see what Projection is used\nsummarise(pa_counties)\n```\n:::\n\n**Questions to answer:**. \n\n- **How many hospitals are in your dataset?**. \n\n  223  \n- **How many census tracts?**. \n  \n  3,345  \n- **What coordinate reference system is each dataset in?**.   \n  \n  All use WGS 84 after I transformed the coordinate system. \n\n---\n\n#### Step 2: Get Demographic Data \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get demographic data from ACS\ndemographic_data <- get_acs(\n  geography = \"tract\",\n  state = \"PA\",\n  variables = c(\n    total_population = \"B01003_001\",\n    median_income = \"B19013_001\",\n#used chatgpt to get tables for all male and female categries above 65\n    a = \"B01001_020\",   \n    b = \"B01001_021\",\n    c = \"B01001_022\",\n    d = \"B01001_023\",\n    e = \"B01001_024\",\n    f = \"B01001_025\",\n    g = \"B01001_044\",\n    h = \"B01001_045\",\n    i = \"B01001_046\",\n    j = \"B01001_047\",\n    k = \"B01001_048\",\n    l = \"B01001_049\"\n  ),\n  year = 2022,\n  survey = \"acs5\",\n  output = \"wide\"\n) %>%\n#adding all categories for 65+ populations to create and aggregate whole.\n  mutate(           \n    pop_65plusE =\n      aE + bE + cE + dE + eE + fE + gE + hE + iE + jE + kE + lE\n      ) %>%\n#removing excess strings (words) to make data more presentable\n  mutate(\n    NAME = NAME %>%\n      str_remove(\"Census Tract \") %>%\n      str_remove(\"; Pennsylvania\")\n  )%>%\n#selecting what to present\n  select(\n    GEOID,\n    `County Name` = NAME,\n    `Total Population` = total_populationE,\n    `Total Population 65 Y+` = pop_65plusE,\n    `Median HH Income` = median_incomeE\n  )\n\n\n#presenting only the first six rows to check for data\nhead(demographic_data)\n \n   \n#using left_join to join demographic data to census tracts using common GEOID\njoin_tract_boundaries <- census_tracts %>%\n  left_join(demographic_data, by = \"GEOID\")\n\n\n#viewing the first six rows of the new joined data\nhead(join_tract_boundaries) \n\n  \n#summarising only the median household income data \njoin_tract_boundaries%>%\n  select(`Median HH Income`)%>%\n  summary()%>%\n  kable(digit = 1)\n```\n:::\n\n\n**Questions to answer:**. \n\n- **What year of ACS data are you using?**.  \n  \n  2022.\n- **How many tracts have missing income data?**. \n\n  2023.\n- **What is the median income across all PA census tracts?**. \n\n  70,188.\n\n---\n\n#### Step 3: Define Vulnerable Populations \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filtering for vulnerable tracts based criteria (less than Q3 median incme and more than 20% those above 65 years)\nidentify_vulnerability <- join_tract_boundaries %>%\n  mutate(\n    plus_pct = (`Total Population 65 Y+` / `Total Population`) * 100,\n    category = case_when(\n      `Median HH Income` < 55924 & plus_pct > 20 ~ \"Vulnerable\",\n      TRUE ~ \"Not Vulnerable\"\n    )\n  )\n\n\n#counts number of vulnerable cases per category, and percentage of vulnerable vs non vulnerable\ncount(identify_vulnerability, category)%>%\n  mutate(\n    percentage_vulner = (n / sum(n))*100 \n#n is the number per category #sum(n) is total count\n  )%>%\n  select(\n    category,\n    n, \n    percentage_vulner)%>%\n  kable(digit = 1)\n\n\n#viewing the data for vulnerability that has been identified\nhead(identify_vulnerability)%>%\n  kable(digit = 1)\n```\n:::\n\n\n**Questions to answer:**. \n\n\n- **What income threshold did you choose and why?**. \n \n  less than 55,943 (Lower Quartile)\n- **What elderly population threshold did you choose and why?**. \n\n  I chose elderly population over 65 year old, and in areas where the   \n  population is more than 20%. \n\n- **How many tracts meet your vulnerability criteria?**. \n  \n  273. \n  \n- **What percentage of PA census tracts are considered vulnerable by your definition?**. \n\n  7.9%. \n\n---\n\n#### Step 4: Calculate Distance to Hospitals \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Transform to appropriate projected CRS, which is 3365, NAD38 PA south. Best for distance calculations\nhos <- st_transform(hospitals, 3365)\nvul <- st_transform(identify_vulnerability, 3365)\n\n\n# Calculate distance from each tract centroid to nearest hospital\nvul_new <- vul %>%\n  filter(category == \"Vulnerable\") %>% \n  mutate(\n    dist_near_hos = as.numeric(\n      st_distance(\n      st_centroid(.), st_union(hos) #st_union makes scattered hospital data into one unit that can be used for calculation \n    )\n    ) / 1609.34 #converting metres to miles \n    )\n\n\n#viewing distance calculated from centroid of vulnerable tract to nearest hospital\nhead(vul_new)%>%\n  kable(digit=1)\n\n\n#calculating summary of distance from hospital data\nnew_summary <- vul_new %>%\n  select(dist_near_hos)%>%\n  summary()\n\n\n#viewing the calculation from above\nnew_summary%>%\n  kable()\n\n\n#identifying (counting) vulnerable tracts more than 15 miles from hospital\ndist_15 <- vul_new%>%\n  filter(dist_near_hos > 15 )%>%\n  count()%>%\n  select(n) %>%\n  st_drop_geometry(.)\n\n\n#viewing above calculation\ndist_15%>%\n  kable()\n```\n:::\n\n\nI chose my projection as 3365 because it is the apt projection for Pennsylvania South for distance calculations. \n\n**Questions to answer:**. \n\n  What is the average distance to the nearest hospital for vulnerable tracts? \n  14.88 Miles\n\n\n**What is the maximum distance?**. \n\n  84.06 Miles\n\n\n\n**How many vulnerable tracts are more than 15 miles from the nearest hospital?**. \n\n  85\n  \n---\n\n#### Step 5: Identify Underserved Areas \n\n\"underserved\" are vulnerable tracts that are more than 15 miles from the nearest hospital.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create underserved variable, categorizing into underserved and not\nunderserved <- vul_new %>%\n  mutate(\n    serv_under_or = case_when(\n      dist_near_hos > 15 ~ \"underserved\",\n      TRUE ~ \"vulnerable but served\"\n    )\n  )\n\n\n#counting number of underserved and vulnerable but served counties, then finding the percentage within each category\nnew1_summary <- underserved %>%\n  count(serv_under_or)%>%\n  mutate (\n    underserv_pct = (n/sum(n)*100)\n  )%>%\n  select(n, serv_under_or, underserv_pct)\n\n\n#viewing what was calculated above\nglimpse(new1_summary)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 2\nColumns: 4\n$ n             <int> 85, 188\n$ serv_under_or <chr> \"underserved\", \"vulnerable but served\"\n$ underserv_pct <dbl> 31.13553, 68.86447\n$ geometry      <MULTIPOLYGON [US_survey_foot]> MULTIPOLYGON (((1506307 154..., MULTIPOLYGON (((1365750 …\n```\n\n\n:::\n:::\n\n\n**Questions to answer:**\n- **How many tracts are underserved?**. \n\n  85 are underserved\n- **What percentage of vulnerable tracts are underserved?**. \n\n  31.1% are underserved\n- **Does this surprise you? Why or why not?**. \n\n   I do not have any context for \"surprise\" here, however I am concerned that     31% areas are underserved. Therefore more intervention and planning is        required. \n\n---\n\n#### Step 6: Aggregate to County Level\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# transforming to NAD83 again string in different variable\npcounty <- st_transform(pa_counties, 3365)\npcensustract <- st_transform(census_tracts, 3365)\n\n\n#creating spatial join of underserved(categorized) and pa counties\nnew_spatial_join <- underserved %>%\n  st_join(pcounty) %>%\n  group_by(COUNTY_NAM) %>% #creating groups by county\n  summarise(              \n# summarise will now place these calculations in the groups of group_by counties\n    total_vulnerable = n(),\n    total_underserved = sum(serv_under_or == \"underserved\"),\n    pct_underserved = (total_underserved / total_vulnerable) * 100,\n    avg_dist = mean(dist_near_hos),\n    total_vul_pop = sum(`Total Population`)\n  )\n\n\n#ensuring compliance with projection system \n st_transform(new_spatial_join, 3365)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 59 features and 6 fields\nGeometry type: GEOMETRY\nDimension:     XY\nBounding box:  xmin: 1204220 ymin: 142405.5 xmax: 2736008 ymax: 1028009\nProjected CRS: NAD83(HARN) / Pennsylvania South (ftUS)\n# A tibble: 59 × 7\n   COUNTY_NAM total_vulnerable total_underserved pct_underserved avg_dist\n * <chr>                 <int>             <int>           <dbl>    <dbl>\n 1 ALLEGHENY                47                 2            4.26     8.03\n 2 ARMSTRONG                 5                 3           60       27.5 \n 3 BEAVER                    8                 1           12.5      9.15\n 4 BEDFORD                   5                 4           80       29.8 \n 5 BERKS                     2                 2          100       19.1 \n 6 BLAIR                     3                 1           33.3     10.1 \n 7 BRADFORD                  3                 2           66.7     31.5 \n 8 CAMBRIA                  14                 7           50       20.8 \n 9 CAMERON                   4                 4          100       48.8 \n10 CARBON                    2                 1           50       16.7 \n# ℹ 49 more rows\n# ℹ 2 more variables: total_vul_pop <dbl>,\n#   geometry <MULTIPOLYGON [US_survey_foot]>\n```\n\n\n:::\n\n```{.r .cell-code}\n# Details by county arranged by descending order of percentage of counties underserved\npct_uns <- new_spatial_join %>% \n  arrange(desc(pct_underserved))\n \n\n#viewing above calculations \npct_uns %>%  \nhead(5) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 5 features and 6 fields\nGeometry type: GEOMETRY\nDimension:     XY\nBounding box:  xmin: 1450456 ymin: 346323.6 xmax: 2560830 ymax: 904781.6\nProjected CRS: NAD83(HARN) / Pennsylvania South (ftUS)\n# A tibble: 5 × 7\n  COUNTY_NAM total_vulnerable total_underserved pct_underserved avg_dist\n  <chr>                 <int>             <int>           <dbl>    <dbl>\n1 BERKS                     2                 2             100     19.1\n2 CAMERON                   4                 4             100     48.8\n3 CENTRE                    3                 3             100     49.5\n4 CLARION                   5                 5             100     40.8\n5 CLINTON                   2                 2             100     36.2\n# ℹ 2 more variables: total_vul_pop <dbl>, geometry <GEOMETRY [US_survey_foot]>\n```\n\n\n:::\n\n```{.r .cell-code}\n#arranging by distance\nnew_spatial_join%>%\n  arrange(desc(avg_dist))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 59 features and 6 fields\nGeometry type: GEOMETRY\nDimension:     XY\nBounding box:  xmin: 1204220 ymin: 142405.5 xmax: 2736008 ymax: 1028009\nProjected CRS: NAD83(HARN) / Pennsylvania South (ftUS)\n# A tibble: 59 × 7\n   COUNTY_NAM total_vulnerable total_underserved pct_underserved avg_dist\n   <chr>                 <int>             <int>           <dbl>    <dbl>\n 1 PERRY                     2                 2             100     57.5\n 2 COLUMBIA                  1                 1             100     55.5\n 3 CENTRE                    3                 3             100     49.5\n 4 CAMERON                   4                 4             100     48.8\n 5 FOREST                    3                 3             100     46.2\n 6 ELK                       5                 5             100     45.8\n 7 HUNTINGDON                3                 3             100     44.5\n 8 SULLIVAN                  2                 2             100     44.4\n 9 MONROE                    3                 3             100     42.3\n10 CLEARFIELD               10                 9              90     42.0\n# ℹ 49 more rows\n# ℹ 2 more variables: total_vul_pop <dbl>, geometry <GEOMETRY [US_survey_foot]>\n```\n\n\n:::\n\n```{.r .cell-code}\n#viewing above calculations\nnew_spatial_join%>%\nhead(5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 5 features and 6 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 1248239 ymin: 142405.5 xmax: 2560830 ymax: 654393.6\nProjected CRS: NAD83(HARN) / Pennsylvania South (ftUS)\n# A tibble: 5 × 7\n  COUNTY_NAM total_vulnerable total_underserved pct_underserved avg_dist\n  <chr>                 <int>             <int>           <dbl>    <dbl>\n1 ALLEGHENY                47                 2            4.26     8.03\n2 ARMSTRONG                 5                 3           60       27.5 \n3 BEAVER                    8                 1           12.5      9.15\n4 BEDFORD                   5                 4           80       29.8 \n5 BERKS                     2                 2          100       19.1 \n# ℹ 2 more variables: total_vul_pop <dbl>,\n#   geometry <MULTIPOLYGON [US_survey_foot]>\n```\n\n\n:::\n\n```{.r .cell-code}\n#attached the summary statistics to the county boundary shapefile so it can be mapped\ncounty_map_data <- pcounty %>%\n  left_join(\n    st_drop_geometry(new_spatial_join), by = \"COUNTY_NAM\")\n\n\n#mapping underserved areas by county to observe potential patterns\nggplot() +\n  geom_sf(data = county_map_data, aes(fill = pct_underserved), color = \"black\") +\n  scale_fill_viridis_c(name = \"% Underserved\", na.value = \"navy\", option = \"inferno\") +\n  labs(title = \"Underserved Vulnerable Populations by County\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](lab2_template--1-_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n**Questions to answer:**. \n\n- **Which 5 counties have the highest percentage of underserved vulnerable tracts?**. \n\n  Berks, Cameron, Centre, Clarion, Clinton\n\n- **Which counties have the most vulnerable people living far from hospitals?**. \n\n  Perry, Columbia, Centre, Cameron, Forest\n\n- **Are there any patterns in where underserved counties are located?**. \n  \n  The vulnerable areas are further away from Philadelphia towards central PA,   with more concentration in central northwest PA.\n  \n---\n\n#### Step 7: Create Summary Table \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create and format priority counties table\n\nhealth_care <- new_spatial_join %>%\n  st_drop_geometry() %>%\n  arrange(desc(pct_underserved), desc(avg_dist)) %>%\n  slice_head(n = 10) %>%\n  mutate(\n    total_vul_pop = comma(total_vul_pop)\n    )%>%\n  select(\n    `County Name` = COUNTY_NAM,\n    `Avg Distance from Nearest Hospital (miles)`= avg_dist,\n    `% Underserved Tracts among Vulnerable Tracts` = pct_underserved,\n    `Population in these Tracts` = total_vul_pop,\n    `Total Underserved Tracts` = total_underserved,\n    `Total Vulnerable Tracts` = total_vulnerable\n  )\n\n\n#displaying the table\nhealth_care%>%\n  kable(\n    digits = 0,\n    caption = \"Priority Table for Healthcare Investments\"\n        )\n```\n\n::: {.cell-output-display}\n\n\nTable: Priority Table for Healthcare Investments\n\n|County Name    | Avg Distance from Nearest Hospital (miles)| % Underserved Tracts among Vulnerable Tracts|Population in these Tracts | Total Underserved Tracts| Total Vulnerable Tracts|\n|:--------------|------------------------------------------:|--------------------------------------------:|:--------------------------|------------------------:|-----------------------:|\n|PERRY          |                                         58|                                          100|5,800                      |                        2|                       2|\n|COLUMBIA       |                                         55|                                          100|918                        |                        1|                       1|\n|CENTRE         |                                         49|                                          100|11,192                     |                        3|                       3|\n|CAMERON        |                                         49|                                          100|8,919                      |                        4|                       4|\n|FOREST         |                                         46|                                          100|6,029                      |                        3|                       3|\n|ELK            |                                         46|                                          100|12,550                     |                        5|                       5|\n|HUNTINGDON     |                                         44|                                          100|7,669                      |                        3|                       3|\n|SULLIVAN       |                                         44|                                          100|4,828                      |                        2|                       2|\n|MONROE         |                                         42|                                          100|7,428                      |                        3|                       3|\n|NORTHUMBERLAND |                                         41|                                          100|20,008                     |                        7|                       7|\n\n\n:::\n:::\n\n\n---\n\n## Part 2: Comprehensive Visualization \n\nUsing the skills from Week 3 (Data Visualization), create publication-quality maps and charts.\n\n### Map 1: County-Level Choropleth \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create county-level access map\nggplot() +\n  geom_sf(data = county_map_data, aes(fill = pct_underserved), color = \"black\") +\n  geom_sf(data = hos, color = \"green\", size = 0.9, alpha = 0.9) +\n  scale_fill_viridis_c(name = \"% Underserved\",option = \"inferno\", na.value = \"navy\") +\n  labs(\n    title = \"Underserved Vulnerable Tracts\",\n    subtitle = \"% of vulnerable counties that are underserved\",\n    caption = \"Green points = Hospitals\"\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](lab2_template--1-_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n---\n\n### Map 2: Detailed Vulnerability Map \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create detailed tract-level map\nggplot() +\n  geom_sf(data = county_map_data, fill = \"white\", color = \"black\") +\n  geom_sf(data = underserved, aes(fill = serv_under_or), color = NA) +\n  geom_sf(data = hos, color = \"green\", size = 0.9, alpha = 0.9) +\n  scale_fill_viridis_d(name = \"Status\", option = \"plasma\") +\n  labs(\n    title = \"Underserved Vulnerable Tracts\",\n    subtitle = \"Tracts vulnerable and more than 15 miles from a hospital are underserved\",\n    caption = \"Green points = Hospitals\"\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](lab2_template--1-_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n---\n\n### Chart: Distribution Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create distribution visualization\nggplot(vul_new) +\n  aes(x = dist_near_hos) +\n  geom_histogram(bins = 25, fill = \"navy\", color = \"white\", alpha = 0.7) +\n   geom_vline(xintercept = 15, color = \"red\", linetype = \"dashed\") +\n  labs(\n    title = \"Distribution of Distances to Nearest Hospital\",\n    x = \"Distance to Nearest Hospital (miles)\",\n    y = \"Number of Vulnerable Tracts\",\n    subtitle = \"red line represents the 15 mile threshold for underserved\",\n    caption = \"most vulnerable census tracts have access to a hospital within 25 miles,\n    with high concentration of around 90 tracts with hospital within 5-10 miles\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](lab2_template--1-_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n---\n\n## Part 3: Bring Your Own Data Analysis \n\n\n\n#### Infrastructure & Services\n\n**Polling Place Accessibility**\n- **Data:** Polling Places, SEPTA stops, Census tracts (elderly population, disability rates)\n- **Question:** \"Are polling places accessible for elderly and disabled voters?\"\n- **Operations:** Buffer polling places and transit stops, identify vulnerable populations, find areas lacking access\n- **Policy relevance:** Voting rights, election infrastructure, ADA compliance\n\n\n1. **Find and load additional data**\n \n\n::: {.cell}\n\n```{.r .cell-code}\n# Load your additional dataset\nphil_censustract <- st_read(\"data/Census_Tracts_2010-shp (3)\")\npolling_places <- st_read(\"data/polling_places\")\ntransit_stops <- st_read(\"data/Transit_Stops_(Spring_2025)\")\n\nshub <- st_transform(phil_censustract, 3365)\ndhub <- st_transform(polling_places,3365)\nlhub <- st_transform(transit_stops,3365)\n```\n:::\n\n\n**Questions to answer:**\n- **What dataset did you choose and why?**. \n\n I chose polling places, transit stops and census tracts(for Philadelphia) to \n analyze voting accessibility. \n\n- **What is the data source and date?**. \n\n The data here are shape files from OpenDataPhilly, all transit Stops as of   \n 2025, census tracts as of 2010, polling places (no date available) \n  \n- **How many features does it contain?**. \n\n  Census Tract (384), Polling Places (1,703), Transit Stops (22,478)\n\n- **What CRS is it in? Did you need to transform it?**. \n  \n  I transformed all to 3365 (NAD83)\n\n---\n\n2. **Pose a research question**.  \n   \n  Do elderly populations have adequate access to polling places via public      transit?\n\n---\n\n3. **Conduct spatial analysis**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your spatial analysis\n\n\n#demographic data from census data using get_acs\na_demographic_data <- get_acs(\n  geography = \"tract\",\n  state = \"PA\",\n  county = \"PHILADELPHIA\",\n  variables = c(\n    atotal_population = \"B01003_001\",\n    a = \"B01001_020\",                  #extracting up all 65+ categories \n    b = \"B01001_021\",\n    c = \"B01001_022\",\n    d = \"B01001_023\",\n    e = \"B01001_024\",\n    f = \"B01001_025\",\n    g = \"B01001_044\",\n    h = \"B01001_045\",\n    i = \"B01001_046\",\n    j = \"B01001_047\",\n    k = \"B01001_048\",\n    l = \"B01001_049\"\n  ),\n  year = 2022,\n  survey = \"acs5\",\n  output = \"wide\"\n) %>%                                  #calculating the total population 65+\n  mutate(\n    apop_65plusE = aE + bE + cE + dE + eE + fE + gE + hE + iE + jE + kE + lE\n  ) %>%\n  mutate(                              #cleaning (removing) strings that were unnecessary\n    NAME = NAME %>%\n      str_remove(\"Census Tract \") %>%\n      str_remove(\"; Pennsylvania\")\n  ) %>%\n  select(                               #rename relevant columns for analysis\n    GEOID,\n    `County Name` = NAME,\n    `Total Population` = atotal_populationE,\n    `Total Population 65 Y+` = apop_65plusE\n  )\n\n\n# joining demographic data to census tracts in Philadelphia\na_census_tract_join <- shub %>%\n  left_join(a_demographic_data, by = c(\"GEOID10\" = \"GEOID\"))\n\n\n# identifying vulnerable tracts 1/3 mile distance from centroid to polling places\na_vulnerable_tracts <- a_census_tract_join %>%\n  mutate(\n    percent = (`Total Population 65 Y+` / `Total Population`) * 100,\n    a_distance = as.numeric(st_distance(st_centroid(shub), st_union(dhub))),\n    vulnerability = case_when(\n      percent > 40 & a_distance > 600 ~ \"Vulnerable!\",\n      TRUE ~ \"Not Vulnerable\"\n    )\n  )\n\n\n\n# filter to vulnerable tracts\nidentify_vulnerabilitya <- a_vulnerable_tracts %>%\n  filter(vulnerability == \"Vulnerable!\")\n\n\n# creating buffer of 0.125 mile around transit stops (easy access for senior citizes)\nstop_buffer <- lhub %>%\n  st_buffer(200)\n\n\n#identifying critical tracts (using disjoint to exclude areas not covered by the transit buffer)\ncritical_tracts <- identify_vulnerabilitya %>%\n  st_filter(stop_buffer, .predicate = st_disjoint) \n\n\n#Identifying most priritizable among the critical tracts, prioritizing based on distance to polling place, followed by percent of 65+\ntop_critical_tracts <- critical_tracts %>%\n  st_drop_geometry() %>%\n  arrange(desc(a_distance), desc(percent)) %>%\n  mutate(\n    `Tract` = str_remove(NAMELSAD10, \"Census Tract \"),\n    `Total Population` = comma(`Total Population`),\n    `Avg Distance to Polling Places (mi)` = a_distance / 1609.34\n  ) %>%\n  select(\n    `Tract`,\n    `Total Population`,\n    `% Vulnerable` = percent,\n    `Avg Distance to Polling Places (mi)`\n  )\n\n\n#viewing and labeling\ntop_critical_tracts %>%\n  kable(\n    digits = 1,\n    caption = \"Critical Tracts for Investment in Elderly Participation in Elections\"\n  )\n```\n\n::: {.cell-output-display}\n\n\nTable: Critical Tracts for Investment in Elderly Participation in Elections\n\n|Tract |Total Population | % Vulnerable| Avg Distance to Polling Places (mi)|\n|:-----|:----------------|------------:|-----------------------------------:|\n|364   |1,004            |         49.8|                                 1.9|\n|220   |1,477            |         46.6|                                 1.9|\n|9802  |405              |         76.5|                                 0.8|\n\n\n:::\n\n```{.r .cell-code}\n#mapping vulnerable tracts and hospitals for visual understanding\nggplot() +\n  geom_sf(data = shub, fill = \"white\", color = \"black\") +\n  geom_sf(data = a_vulnerable_tracts, aes(fill = percent), color = NA) +\n  geom_sf(data = dhub, color = \"green\", size = 0.05, alpha = 0.5) +\n  scale_fill_viridis_c(name = \"% Age 65+\", option = \"plasma\") +\n  labs(\n    title = \"Polling Access vulnerability in Philadelphia\",\n    subtitle = \"vulnerability chloropleth\",\n    caption = \"Green points = Polling Places\"\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](lab2_template--1-_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#converting critical tracts into geometric\ncritical_top3pls <- critical_tracts %>%\n  filter(NAMELSAD10 %in% c(\"Census Tract 364\", \"Census Tract 220\", \"Census Tract 9802\"))\n\n\n\nggplot() +\n  geom_sf(data = shub, fill = \"gold\", color = \"gold\") +\n  geom_sf(data = critical_top3pls, fill = \"lightblue\", alpha = 0.7) +\n  geom_sf(data = dhub, color = \"red\", size = 0.05, alpha = 0.5) +\n  labs(\n    title = \"Top 3 Critical Tracts for Elderly Polling Access\",\n    subtitle = \"blue tracts are disconnected from transit and far from polling places\",\n    caption = \"red points = Polling Places\"\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](lab2_template--1-_files/figure-html/unnamed-chunk-12-2.png){width=672}\n:::\n:::\n\n\n\n**Your interpretation:**\nPhiladelphia is mostly covered via transit connections, whether it be regional rail, SEPTA subway, or buses. However, gaps remain in three critical census tract areas: tracts 364, 220, and 9802. Not only do these tracts have a vulnerable population above the 20% threshold, with those aged 65 and above exceeding 45%, but the average distance to a polling place is more than a third of a mile. This is a significant concern for elderly residents, as these tracts also fall outside the 0.125-mile transit buffer entirely. While this distance may not seem substantial, most elderly individuals suffer from arthritis and knee-related issues, making walkability a critical factor. It is therefore essential that their inclusivity be prioritized. \n\n\n## Comments about your incorporation of feedback!\nI cleaned up the presentation and only included essential information for display on quarto. Unnecessary details were attempted to be excluded.\n\n##Acknowledgements \n\nI consulted lab1 codes, week4 lecture codes, week4 inclass practice codes,week 3 lab exercies, week 3 qmd.\n\nI also consulted:     \n\nsf cheat sheet:\nhttps://rstudio.github.io/cheatsheets/sf.pdf\ngg plot cheat sheet: https://rstudio.github.io/cheatsheets/data-visualization.pdf\ndplyr cheat sheet: \nhttps://nyu-cdsc.github.io/learningr/assets/data-transformation.pdf\n\nBesides I consulted Claude and Chat GPT- coding by myself, then consulting it for corrections. \n\n\n\n\n\n---\n\n\n---\n\n",
    "supporting": [
      "lab2_template--1-_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}