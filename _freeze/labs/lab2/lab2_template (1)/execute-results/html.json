{
  "hash": "0baa2c021de8254181b777b3cdfdfcce",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lab 2: Spatial Analysis and Visualization\"\nsubtitle: \"Healthcare Access and Equity in Pennsylvania\"\nauthor: \"Shubhanga Satyal\"\ndate: today\nformat: \n  html:\n    code-fold: false\n    toc: true\n    toc-location: left\n    theme: cosmo\n    embed-resources: true\nexecute:\n  warning: false\n  message: false\n---\n\n## Assignment Overview\n\n**Learning Objectives:**\n- Apply spatial operations to answer policy-relevant research questions\n- Integrate census demographic data with spatial analysis\n- Create publication-quality visualizations and maps\n- Work with spatial data from multiple sources\n- Communicate findings effectively for policy audiences\n\n---\n\n## Part 1: Healthcare Access for Vulnerable Populations\n\n\n### Research Question\n\n**Which Pennsylvania counties have the highest proportion of vulnerable populations (elderly + low-income) living far from hospitals?**\n\nYour analysis should identify counties that should be priorities for healthcare investment and policy intervention.\n\n### Required Analysis Steps\n\nComplete the following analysis, documenting each step with code and brief explanations:\n\n#### Step 1: Data Collection (5 points)\n\nLoad the required spatial data:\n- Pennsylvania county boundaries\n- Pennsylvania hospitals (from lecture data)\n- Pennsylvania census tracts\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(tidyverse)\nlibrary(tidycensus)\nlibrary(scales)\nlibrary(RColorBrewer)\nlibrary(sf)\nlibrary(tidyverse)\nlibrary(tigris)\nlibrary(tidycensus)\nlibrary(scales)\nlibrary(patchwork)\nlibrary(knitr)\n# Load spatial data\n\n\npa_counties <- st_read(\"data/Pennsylvania_County_Boundaries.shp\")\nhospitals <- st_read(\"data/hospitals.geojson\")\ncensus_tracts <- tracts(state = \"PA\", cb = TRUE)\n\n\nhospitals <- st_transform(hospitals, st_crs(pa_counties))\ncensus_tracts <- st_transform(census_tracts, st_crs(pa_counties))\n\n# Check that all data loaded correctly\nhead(pa_counties)%>%\n  kable()\nhead(hospitals)%>%\n  kable()\nhead(census_tracts)%>%\n  kable()\nhead(census_tracts)%>%\n  kable()\n\nsummarise(pa_counties)\n```\n:::\n\n\n**Questions to answer:**. \n\n\n\n- **How many hospitals are in your dataset?**. \n\n  223  \n- **How many census tracts?**. \n  \n  3,345  \n- **What coordinate reference system is each dataset in?**.   \n  \n  \n  All use WGS 84 after I transformed the coordinate system. \n\n---\n\n#### Step 2: Get Demographic Data \n\nUse `tidycensus` to download tract-level demographic data for Pennsylvania.\n\n**Required variables:**\n- Total population\n- Median household income\n- Population 65 years and over (you may need to sum multiple age categories)\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get demographic data from ACS\ndemographic_data <- get_acs(\n  geography = \"tract\",\n  state = \"PA\",\n  variables = c(\n    total_population = \"B01003_001\",\n    median_income = \"B19013_001\",\n    a = \"B01001_020\",\n    b = \"B01001_021\",\n    c = \"B01001_022\",\n    d = \"B01001_023\",\n    e = \"B01001_024\",\n    f = \"B01001_025\",\n    g = \"B01001_044\",\n    h = \"B01001_045\",\n    i = \"B01001_046\",\n    j = \"B01001_047\",\n    k = \"B01001_048\",\n    l = \"B01001_049\"\n  ),\n  year = 2022,\n  survey = \"acs5\",\n  output = \"wide\"\n) %>%\n  mutate(\n    pop_65plusE =\n      aE + bE + cE + dE + eE + fE +\n      gE + hE + iE + jE + kE + lE\n      ) %>%\n  mutate(\n    NAME = NAME %>%\n      str_remove(\"Census Tract \") %>%\n      str_remove(\"; Pennsylvania\")\n  )%>%\n  select(\n    GEOID,\n    `County Name` = NAME,\n    `Total Population` = total_populationE,\n    `Total Population 65 Y+` = pop_65plusE,\n    `Median HH Income` = median_incomeE\n  )\n\nhead(demographic_data)%>%\n  kable()\n  \n\n# Join to tract boundaries\njoin_tract_boundaries <- census_tracts %>%\n  left_join(demographic_data, by = \"GEOID\")\n\nhead(join_tract_boundaries) %>%\n  kable()\n\n\njoin_tract_boundaries%>%\n  select(`Median HH Income`)%>%\n  summary()%>%\n  kable()\n```\n:::\n\n\n**Questions to answer:**. \n\n\n\n\n\n\n- **What year of ACS data are you using?**.  \n  \n  \n  2022.\n\n- **How many tracts have missing income data?**. \n\n\n  2023.\n\n- **What is the median income across all PA census tracts?**. \n\n\n  70,188.\n\n---\n\n#### Step 3: Define Vulnerable Populations \n\nIdentify census tracts with vulnerable populations based on TWO criteria:\n1. Low median household income (choose an appropriate threshold)\n2. Significant elderly population (choose an appropriate threshold)\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter for vulnerable tracts based on your criteria\n\nidentify_vulnerability <- join_tract_boundaries %>%\n  mutate(\n    plus_pct = (`Total Population 65 Y+` / `Total Population`) * 100,\n    category = case_when(\n      `Median HH Income` < 55924 & plus_pct > 20 ~ \"Vulnerable\",\n      TRUE ~ \"Not Vulnerable\"\n    )\n  )\n\ncount(identify_vulnerability, category)%>%\n  mutate(\n    percentage_vulner = (n / sum(n))*100\n  )%>%\n  select(category, n, percentage_vulner)%>%\n  kable(digit = 1)\n\nhead(identify_vulnerability)%>%\n  kable(digit = 1)\n```\n:::\n\n\n**Questions to answer:**. \n\n\n- **What income threshold did you choose and why?**. \n \n \n  less than 55,943 (Lower Quartile)\n  \n- **What elderly population threshold did you choose and why?**. \n\n\n  I chose elderly population over 65 year old, and in areas where the population is more than 20%. \n\n- **How many tracts meet your vulnerability criteria?**. \n  \n  \n  273. \n  \n- **What percentage of PA census tracts are considered vulnerable by your definition?**. \n\n  \n  7.9%. \n\n---\n\n#### Step 4: Calculate Distance to Hospitals \n\nFor each vulnerable tract, calculate the distance to the nearest hospital.\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Transform to appropriate projected CRS\nhos <- st_transform(hospitals, 3365)\nvul <- st_transform(identify_vulnerability, 3365)\n\n# Calculate distance from each tract centroid to nearest hospital\nvul_new <- vul %>%\n  filter(category == \"Vulnerable\") %>% \n  mutate(\n    dist_near_hos = as.numeric(st_distance(\n      st_centroid(.), st_union(hos)\n    )) / 1609.34\n    )\nhead(vul_new)%>%\n  kable(digit=1)\n\nnew_summary <- vul_new %>%\n  select(dist_near_hos)%>%\n  summary()\n\nnew_summary%>%\n  kable()\n\ndist_15 <- vul_new%>%\n  filter(dist_near_hos > 15 )%>%\n  count()%>%\n  select(n) %>%\n  st_drop_geometry(.)\ndist_15%>%\n  kable()\n```\n:::\n\n\n**Requirements:**\n- Use an appropriate projected coordinate system for Pennsylvania\n- Calculate distances in miles\n- Explain why you chose your projection\n\nI chose my projection as 3365 because it is the apt projection for Pennsylvania South for distance calculations. \n\n**Questions to answer:**. \n\n  \n  \n   What is the average distance to the nearest hospital for vulnerable tracts?  14.88 Miles\n\n\n**What is the maximum distance?** \n   \n   84.06 Miles\n\n\n\n**How many vulnerable tracts are more than 15 miles from the nearest hospital?**. \n  \n  \n  85\n  \n---\n\n#### Step 5: Identify Underserved Areas \n\nDefine \"underserved\" as vulnerable tracts that are more than 15 miles from the nearest hospital.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create underserved variable\n\nunderserved <- vul_new %>%\n  mutate(\n    serv_under_or = case_when(\n      dist_near_hos > 15 ~ \"underserved\",\n      TRUE ~ \"vulnerable but served\"\n    )\n  )\n\nnew1_summary <- underserved %>%\n  count(serv_under_or)%>%\n  mutate (\n    underserv_pct = (n/sum(n)*100)\n  )\n\nglimpse(new1_summary)%>%\n  kable(digit = 1)\n```\n:::\n\n\n**Questions to answer:**\n- **How many tracts are underserved?**\n\n  85 are underserved\n\n\n- **What percentage of vulnerable tracts are underserved?**. \n\n  31.1% are underserved\n  \n- **Does this surprise you? Why or why not?**. \n\n  I do not have any context for \"surprise\" here, however I am conerned that     31% areas are underserved. Therefore more intervention and planning is        required. \n\n---\n\n#### Step 6: Aggregate to County Level\n\nUse spatial joins and aggregation to calculate county-level statistics about vulnerable populations and hospital access.\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Spatial join tracts to counties\n\n\npcounty <- st_transform(pa_counties, 3365)\npcensustract <- st_transform(census_tracts, 3365)\n\nnew_spatial_join <- underserved %>%\n  st_join(pcounty) %>%\n  group_by(COUNTY_NAM) %>%\n  summarise(\n    total_vulnerable = n(),\n    total_underserved = sum(serv_under_or == \"underserved\"),\n    pct_underserved = (total_underserved / total_vulnerable) * 100,\n    avg_dist = mean(dist_near_hos),\n    total_vul_pop = sum(`Total Population`)\n  )\n\n st_transform(new_spatial_join, 3365)\n \n\n# Aggregate statistics by county\npct_uns <- new_spatial_join %>% \n  arrange(desc(pct_underserved))%>%\n  head(5) %>%\n  kable(digits = 1)\n\nnew_spatial_join%>%\n  arrange(desc(avg_dist))%>%\n  head(5)%>%\n  kable()\n\ncounty_map_data <- pcounty %>%\n  left_join(\n    st_drop_geometry(new_spatial_join), by = \"COUNTY_NAM\")\n\nggplot() +\n  geom_sf(data = county_map_data, aes(fill = pct_underserved), color = \"black\") +\n  scale_fill_viridis_c(name = \"% Underserved\", na.value = \"navy\", option = \"inferno\") +\n  labs(title = \"Underserved Vulnerable Populations by County\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](lab2_template--1-_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n**Required county-level statistics:**\n- Number of vulnerable tracts. \n- Number of underserved tracts  \n- Percentage of vulnerable tracts that are underserved\n- Average distance to nearest hospital for vulnerable tracts\n- Total vulnerable population\n\n**Questions to answer:**. \n\n\n- **Which 5 counties have the highest percentage of underserved vulnerable tracts?**. \n  \n  Berks, Cameron, Centre, Clarion, Clinton\n\n- **Which counties have the most vulnerable people living far from hospitals?**. \n  \n  Perry, Columbia, Centre, Cameron, Forest\n\n- **Are there any patterns in where underserved counties are located?**. \n  \n  \n  The vulnerable areas are further away from Philadelphia towards central PA, with more concentration in central northwest PA.\n  \n---\n\n#### Step 7: Create Summary Table \n\nCreate a professional table showing the top 10 priority counties for healthcare investment.\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create and format priority counties table\n\nnames(new_spatial_join)\nhealth_care <- new_spatial_join %>%\n  st_drop_geometry() %>%\n  arrange(desc(pct_underserved), desc(avg_dist)) %>%\n  slice_head(n = 10) %>%\n  mutate(\n    total_vul_pop = comma(total_vul_pop)\n    )%>%\n  select(\n    `County Name` = COUNTY_NAM,\n    `Avg Distance from Nearest Hospital (miles)`= avg_dist,\n    `% Underserved Tracts among Vulnerable Tracts` = pct_underserved,\n    `Population in these Tracts` = total_vul_pop,\n    `Total Underserved Tracts` = total_underserved,\n    `Total Vulnerable Tracts` = total_vulnerable\n  )\n\nhealth_care%>%\n  kable(\n    digits = 0,\n    caption = \"Priority Table for Healthcare Investments\"\n        )\n```\n:::\n\n\n**Requirements:**\n- Use `knitr::kable()` or similar for formatting\n- Include descriptive column names\n- Format numbers appropriately (commas for population, percentages, etc.)\n- Add an informative caption\n- Sort by priority (you decide the metric)\n\n---\n\n## Part 2: Comprehensive Visualization \n\nUsing the skills from Week 3 (Data Visualization), create publication-quality maps and charts.\n\n### Map 1: County-Level Choropleth \n\nCreate a choropleth map showing healthcare access challenges at the county level.\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create county-level access map\n\nggplot() +\n  geom_sf(data = county_map_data, aes(fill = pct_underserved), color = \"black\") +\n  geom_sf(data = hos, color = \"green\", size = 0.9, alpha = 0.9) +\n  scale_fill_viridis_c(name = \"% Underserved\",option = \"inferno\", na.value = \"navy\") +\n  labs(\n    title = \"Underserved Vulnerable Tracts\",\n    subtitle = \"% of vulnerable counties that are underserved\",\n    caption = \"Green points = Hospitals\"\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](lab2_template--1-_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n**Requirements:**\n- Fill counties by percentage of vulnerable tracts that are underserved\n- Include hospital locations as points\n- Use an appropriate color scheme\n- Include clear title, subtitle, and caption\n- Use `theme_void()` or similar clean theme\n- Add a legend with formatted labels\n\n---\n\n### Map 2: Detailed Vulnerability Map \n\nCreate a map highlighting underserved vulnerable tracts.\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create detailed tract-level map\n\nggplot() +\n  geom_sf(data = county_map_data, fill = \"white\", color = \"black\") +\n  geom_sf(data = underserved, aes(fill = serv_under_or), color = NA) +\n  geom_sf(data = hos, color = \"green\", size = 0.9, alpha = 0.9) +\n  scale_fill_viridis_d(name = \"Status\", option = \"plasma\") +\n  labs(\n    title = \"Underserved Vulnerable Tracts\",\n    subtitle = \"Tracts vulnerable and more than 15 miles from a hospital are underserved\",\n    caption = \"Green points = Hospitals\"\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](lab2_template--1-_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n**Requirements:**\n- Show underserved vulnerable tracts in a contrasting color\n- Include county boundaries for context\n- Show hospital locations\n- Use appropriate visual hierarchy (what should stand out?)\n- Include informative title and subtitle\n\n---\n\n### Chart: Distribution Analysis\n\nCreate a visualization showing the distribution of distances to hospitals for vulnerable populations.\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create distribution visualization\n\nggplot(vul_new) +\n  aes(x = dist_near_hos) +\n  geom_histogram(bins = 25, fill = \"navy\", color = \"white\", alpha = 0.7) +\n   geom_vline(xintercept = 15, color = \"red\", linetype = \"dashed\") +\n  labs(\n    title = \"Distribution of Distances to Nearest Hospital\",\n    x = \"Distance to Nearest Hospital (miles)\",\n    y = \"Number of Vulnerable Tracts\",\n    subtitle = \"red line represents the 15 mile threshold for underserved\",\n    caption = \"most vulnerable census tracts have access to a hospital within 25 miles,\n    with high concentration of around 90 tracts with hospital within 5-10 miles\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](lab2_template--1-_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n**Suggested chart types:**\n- Histogram or density plot of distances\n- Box plot comparing distances across regions\n- Bar chart of underserved tracts by county\n- Scatter plot of distance vs. vulnerable population size\n\n**Requirements:**\n- Clear axes labels with units\n- Appropriate title\n- Professional formatting\n- Brief interpretation (1-2 sentences as a caption or in text)\n\n---\n\n## Part 3: Bring Your Own Data Analysis \n\nChoose your own additional spatial dataset and conduct a supplementary analysis.\n\n### Challenge Options\n\nChoose ONE of the following challenge exercises, or propose your own research question using OpenDataPhilly data (https://opendataphilly.org/datasets/). \n\n**Note these are just loose suggestions to spark ideas - follow or make your own as the data permits and as your ideas evolve. This analysis should include bringing in your own dataset, ensuring the projection/CRS of your layers align and are appropriate for the analysis (not lat/long or geodetic coordinate systems). The analysis portion should include some combination of spatial and attribute operations to answer a relatively straightforward question**\n\n---\n\n#### Education & Youth Services\n\n**Option A: Educational Desert Analysis**\n- **Data:** Schools, Libraries, Recreation Centers, Census tracts (child population)\n- **Question:** \"Which neighborhoods lack adequate educational infrastructure for children?\"\n- **Operations:** Buffer schools/libraries (0.5 mile walking distance), identify coverage gaps, overlay with child population density\n- **Policy relevance:** School district planning, library placement, after-school program siting\n\n**Option B: School Safety Zones**\n- **Data:** Schools, Crime Incidents, Bike Network\n- **Question:** \"Are school zones safe for walking/biking, or are they crime hotspots?\"\n- **Operations:** Buffer schools (1000ft safety zone), spatial join with crime incidents, assess bike infrastructure coverage\n- **Policy relevance:** Safe Routes to School programs, crossing guard placement\n\n---\n\n#### Environmental Justice\n\n**Option C: Green Space Equity** \n- **Data:** Parks, Street Trees, Census tracts (race/income demographics)\n- **Question:** \"Do low-income and minority neighborhoods have equitable access to green space?\"\n- **Operations:** Buffer parks (10-minute walk = 0.5 mile), calculate tree canopy or park acreage per capita, compare by demographics\n- **Policy relevance:** Climate resilience, environmental justice, urban forestry investment\n---\n\n#### Public Safety & Justice\n\n**Option D: Crime & Community Resources**\n- **Data:** Crime Incidents, Recreation Centers, Libraries, Street Lights\n- **Question:** \"Are high-crime areas underserved by community resources?\"\n- **Operations:** Aggregate crime counts to census tracts or neighborhoods, count community resources per area, spatial correlation analysis\n- **Policy relevance:** Community investment, violence prevention strategies\n---\n\n#### Infrastructure & Services\n\n**Option E: Polling Place Accessibility**\n- **Data:** Polling Places, SEPTA stops, Census tracts (elderly population, disability rates)\n- **Question:** \"Are polling places accessible for elderly and disabled voters?\"\n- **Operations:** Buffer polling places and transit stops, identify vulnerable populations, find areas lacking access\n- **Policy relevance:** Voting rights, election infrastructure, ADA compliance\n\n---\n\n#### Health & Wellness\n\n**Option F: Recreation & Population Health**\n- **Data:** Recreation Centers, Playgrounds, Parks, Census tracts (demographics)\n- **Question:** \"Is lack of recreation access associated with vulnerable populations?\"\n- **Operations:** Calculate recreation facilities per capita by neighborhood, buffer facilities for walking access, overlay with demographic indicators\n- **Policy relevance:** Public health investment, recreation programming, obesity prevention\n\n---\n\n#### Emergency Services\n\n**Option G: EMS Response Coverage**\n- **Data:** Fire Stations, EMS stations, Population density, High-rise buildings\n- **Question:** \"Are population-dense areas adequately covered by emergency services?\"\n- **Operations:** Create service area buffers (5-minute drive = ~2 miles), assess population coverage, identify gaps in high-density areas\n- **Policy relevance:** Emergency preparedness, station siting decisions\n\n---\n\n#### Arts & Culture\n\n**Option H: Cultural Asset Distribution**\n- **Data:** Public Art, Museums, Historic sites/markers, Neighborhoods\n- **Question:** \"Do all neighborhoods have equitable access to cultural amenities?\"\n- **Operations:** Count cultural assets per neighborhood, normalize by population, compare distribution across demographic groups\n- **Policy relevance:** Cultural equity, tourism, quality of life, neighborhood identity\n\n---\n\n### Data Sources\n\n**OpenDataPhilly:** https://opendataphilly.org/datasets/\n- Most datasets available as GeoJSON, Shapefile, or CSV with coordinates\n- Always check the Metadata for a data dictionary of the fields.\n\n**Additional Sources:**\n- **Pennsylvania Open Data:** https://data.pa.gov/\n- **Census Bureau (via tidycensus):** Demographics, economic indicators, commute patterns\n- **TIGER/Line (via tigris):** Geographic boundaries\n\n### Recommended Starting Points\n\n**If you're feeling confident:** Choose an advanced challenge with multiple data layers. \n**If you are a beginner, choose something more manageable that helps you understand the basics**\n\n\n**If you have a different idea:** Propose your own question! Just make sure:\n- You can access the spatial data\n- You can perform at least 2 spatial operations\n\n### Your Analysis\n\n**Your Task:**\n\n#### Infrastructure & Services\n\n**Option E: Polling Place Accessibility**\n- **Data:** Polling Places, SEPTA stops, Census tracts (elderly population, disability rates)\n- **Question:** \"Are polling places accessible for elderly and disabled voters?\"\n- **Operations:** Buffer polling places and transit stops, identify vulnerable populations, find areas lacking access\n- **Policy relevance:** Voting rights, election infrastructure, ADA compliance\n\n\n1. **Find and load additional data**\n   - Document your data source\n   - Check and standardize the CRS\n   - Provide basic summary statistics\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load your additional dataset\n\nphil_censustract <- st_read(\"data/Census_Tracts_2010-shp (3)\")\npolling_places <- st_read(\"data/polling_places\")\ntransit_stops <- st_read(\"data/Transit_Stops_(Spring_2025)\")\n\nshub <- st_transform(phil_censustract, 3365)\ndhub <- st_transform(polling_places,3365)\nlhub <- st_transform(transit_stops,3365)\n```\n:::\n\n\n**Questions to answer:**\n- **What dataset did you choose and why?**. \n   \n   I chose polling places, transit stops and census tracts(for Philadelphia) to analyze voting accessibility. \n\n- **What is the data source and date?**\n    \n  The data here are shape files from OpenDataPhilly, all transit Stops as of 2025, census tracts as of 2010, polling places (no date available) \n  \n- **How many features does it contain?**\n   Census Tract (384), Polling Places (1,703), Transit Stops (22,478)\n\n- **What CRS is it in? Did you need to transform it?**\n   I transformed all to 3365 (NAD83)\n\n---\n\n2. **Pose a research question**.  \n   \n   \n   Do elderly and disabled populations have adequate access to polling places via public transit?\n\n\n---\n\n3. **Conduct spatial analysis**\n\nUse at least TWO spatial operations to answer your research question.\n\n**Required operations (choose 2+):**\n- Buffers\n- Spatial joins\n- Spatial filtering with predicates\n- Distance calculations\n- Intersections or unions\n- Point-in-polygon aggregation\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your spatial analysis\n\n                                       #demographic data from census data using get_acs\n\na_demographic_data <- get_acs(\n  geography = \"tract\",\n  state = \"PA\",\n  county = \"PHILADELPHIA\",\n  variables = c(\n    atotal_population = \"B01003_001\",\n    a = \"B01001_020\",                  #extracting up all 65+ categories \n    b = \"B01001_021\",\n    c = \"B01001_022\",\n    d = \"B01001_023\",\n    e = \"B01001_024\",\n    f = \"B01001_025\",\n    g = \"B01001_044\",\n    h = \"B01001_045\",\n    i = \"B01001_046\",\n    j = \"B01001_047\",\n    k = \"B01001_048\",\n    l = \"B01001_049\"\n  ),\n  year = 2022,\n  survey = \"acs5\",\n  output = \"wide\"\n) %>%                                  #calculating the total population 65+\n  mutate(\n    apop_65plusE =\n      aE + bE + cE + dE + eE + fE +\n      gE + hE + iE + jE + kE + lE\n  ) %>%\n  mutate(                              #cleaning (removing) strings that were unnecessary\n    NAME = NAME %>%\n      str_remove(\"Census Tract \") %>%\n      str_remove(\"; Pennsylvania\")\n  ) %>%\n  select(                               #rename relevant columns for analysis\n    GEOID,\n    `County Name` = NAME,\n    `Total Population` = atotal_populationE,\n    `Total Population 65 Y+` = apop_65plusE\n  )\n\n\n\n# joining demographic data to census tracts in Philadelphia\na_census_tract_join <- shub %>%\n  left_join(a_demographic_data, by = c(\"GEOID10\" = \"GEOID\"))\n\n# identifying vulnerable tracts 1/3 mile distance from centroid to polling places\na_vulnerable_tracts <- a_census_tract_join %>%\n  mutate(\n    percent = (`Total Population 65 Y+` / `Total Population`) * 100,\n    a_distance = as.numeric(st_distance(st_centroid(shub), st_union(dhub))),\n    vulnerability = case_when(\n      percent > 40 & a_distance > 600 ~ \"Vulnerable!\",\n      TRUE ~ \"Not Vulnerable\"\n    )\n  )\n\nhead(a_vulnerable_tracts) %>%\n  kable()\n\n# filter to vulnerable tracts\nidentify_vulnerabilitya <- a_vulnerable_tracts %>%\n  filter(vulnerability == \"Vulnerable!\")\n\n# creating buffer of 0.124 mile around transit stops (easy access for senior citizes)\nstop_buffer <- lhub %>%\n  st_buffer(200)\n\n\n#identifying critical tracts (using disjoint to exclude areas not covered by the transit buffer)\ncritical_tracts <- identify_vulnerabilitya %>%\n  st_filter(stop_buffer, .predicate = st_disjoint)\n\nnames(critical_tracts)\n\n\n#picking top 10 among the critical ones, prioritizing based on distance to polling place, followed by percent of 65+\ntop10_critical_tracts <- critical_tracts %>%\n  st_drop_geometry() %>%\n  arrange(desc(a_distance), desc(percent)) %>%\n  slice_head(n = 10) %>%\n  mutate(\n    `Tract` = str_remove(NAMELSAD10, \"Census Tract \"),\n    `Total Population` = comma(`Total Population`),\n    `Avg Distance to Polling Places (mi)` = a_distance / 1609.34\n  ) %>%\n  select(\n    `Tract`,\n    `Total Population`,\n    `% Vulnerable` = percent,\n    `Avg Distance to Polling Places (mi)`\n  )\n\ntop10_critical_tracts %>%\n  kable(\n    digits = 1,\n    caption = \"Top 10 Critical Tracts for Investment\"\n  )\n\n\nnames(a_vulnerable_tracts)\n\n\nggplot() +\n  geom_sf(data = shub, fill = \"white\", color = \"black\") +\n  geom_sf(data = a_vulnerable_tracts, aes(fill = percent), color = NA) +\n  geom_sf(data = dhub, color = \"green\", size = 0.05, alpha = 0.5) +\n  scale_fill_viridis_c(name = \"% Age 65+\", option = \"plasma\") +\n  labs(\n    title = \"Polling Access vulnerability in Philadelphia\",\n    subtitle = \"vulnerability chloropleth\",\n    caption = \"Green points = Polling Places\"\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](lab2_template--1-_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n**Analysis requirements:**\n- Clear code comments explaining each step\n- Appropriate CRS transformations\n- Summary statistics or counts\n- At least one map showing your findings\n- Brief interpretation of results (3-5 sentences)\n\n**Your interpretation:**\n\n[Write your findings here]\n\n\n## Finally - A few comments about your incorporation of feedback!\nTake a few moments to clean up your markdown document and then write a line or two or three about how you may have incorporated feedback that you recieved after your first assignment. \n\n---\n\n## Submission Requirements\n\n**What to submit:**\n\n1. **Rendered HTML document posted to your course portfolio** with all code, outputs, maps, and text\n   - Use `embed-resources: true` in YAML so it's a single file\n   - All code should run without errors\n   - All maps and charts should display correctly\n2. Submit the correct and working links of your assignment on Canvas\n\n---\n\n",
    "supporting": [
      "lab2_template--1-_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}